<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0" />
  <title>Aura Gaming PC Optimizer</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #0f0f0f 0%, #1a1a2e 50%, #16213e 100%);
      color: #ffffff;
      overflow: hidden;
      user-select: none;
    }
    /* Custom Titlebar */
    .titlebar {
      height: 32px;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 16px;
      -webkit-app-region: drag;
      border-bottom: 1px solid rgba(0, 255, 136, 0.2);
    }
    .titlebar-title { font-size: 13px; font-weight: 600; color: #00ff88; }
    .titlebar-controls { display: flex; gap: 8px; -webkit-app-region: no-drag; }
    .titlebar-button {
      width: 24px; height: 24px; border: none; border-radius: 4px; cursor: pointer;
      display: flex; align-items: center; justify-content: center; font-size: 12px;
      transition: background 0.2s;
    }
    .titlebar-button.minimize { background: #4a5568; }
    .titlebar-button.maximize { background: #2d3748; }
    .titlebar-button.close { background: #e53e3e; }
    .titlebar-button:hover { opacity: 0.8; transform: scale(1.05); }

    /* Main Container */
    .main-container {
  display: flex;
  height: calc(100vh - 32px);
  min-height: calc(100vh - 32px);
  max-height: calc(100vh - 32px);
}

    /* Sidebar */
    .sidebar {
  width: 280px;
  background: rgba(15, 15, 15, 0.9);
  border-right: 1px solid rgba(0, 255, 136, 0.2);
  display: flex;
  flex-direction: column;
  flex-shrink: 0;
}
    .sidebar-header {
      padding: 24px 20px 16px; text-align: center;
      border-bottom: 1px solid rgba(0, 255, 136, 0.1);
    }
    .logo {
      font-size: 28px; font-weight: 800; margin-bottom: 8px;
      background: linear-gradient(45deg, #00ff88, #00b4d8);
      -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;
    }
    .tagline { font-size: 12px; color: #8a92a5; text-transform: uppercase; letter-spacing: 1px; }
    .nav-menu { flex: 1; padding: 16px 0; }
    .nav-item {
      display: flex; align-items: center; padding: 12px 20px; cursor: pointer;
      transition: all 0.3s; border-left: 3px solid transparent; margin: 2px 0;
    }
    .nav-item:hover { background: rgba(0, 255, 136, 0.1); border-left-color: #00ff88; }
    .nav-item.active { background: rgba(0, 255, 136, 0.15); border-left-color: #00ff88; }
    .nav-icon { width: 20px; height: 20px; margin-right: 12px; opacity: 0.7; }
    .nav-item.active .nav-icon { opacity: 1; }

    .license-status { padding: 16px 20px; border-top: 1px solid rgba(0, 255, 136, 0.1); }
    .status-indicator {
      display: flex; align-items: center; gap: 8px; padding: 8px 12px;
      border-radius: 6px; font-size: 12px; font-weight: 600;
    }
    .status-indicator.active { background: rgba(0, 255, 136, 0.1); color: #00ff88; }
    .status-indicator.inactive { background: rgba(255, 71, 87, 0.1); color: #ff4757; }
    .status-dot { width: 8px; height: 8px; border-radius: 50%; }
    .status-indicator.active .status-dot {
      background: #00ff88; box-shadow: 0 0 8px rgba(0, 255, 136, 0.6); animation: pulse 2s infinite;
    }
    .status-indicator.inactive .status-dot { background: #ff4757; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

    /* Content Area */
    .content {
  flex: 1;
  display: block; /* Change from flex to block */
  background: rgba(30, 30, 30, 0.1);
  height: calc(100vh - 32px);
}
    .content-header {
  position: sticky;
  top: 0;
  z-index: 10;
  padding: 20px 24px;
  border-bottom: 1px solid rgba(0, 255, 136, 0.1);
  background: rgba(0, 0, 0, 0.3);
}
    .content-title { font-size: 24px; font-weight: 700; margin-bottom: 8px; color: #ffffff; }
    .content-subtitle { font-size: 14px; color: #8a92a5; }
    .content-body {
  padding: 24px;
  height: calc(100vh - 32px - 104px); /* minus titlebar and header */
  overflow-y: scroll;
  overflow-x: hidden;
}

    /* Dashboard */
    .dashboard-grid {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px; margin-bottom: 24px;
    }
    .stat-card {
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(0, 255, 136, 0.2);
      border-radius: 12px; padding: 20px; backdrop-filter: blur(10px); transition: all 0.3s;
    }
    .stat-card:hover { border-color: rgba(0, 255, 136, 0.4); transform: translateY(-2px); }
    .stat-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
    .stat-title { font-size: 14px; color: #8a92a5; text-transform: uppercase; letter-spacing: 1px; }
    .stat-icon { width: 24px; height: 24px; opacity: 0.6; }
    .stat-value { font-size: 28px; font-weight: 700; color: #ffffff; margin-bottom: 8px; }
    .stat-label { font-size: 12px; color: #8a92a5; }
    .progress-bar { width: 100%; height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; overflow: hidden; margin-top: 12px; }
    .progress-fill { height: 100%; background: linear-gradient(90deg, #00ff88, #00b4d8); border-radius: 3px; transition: width 0.3s; }

    /* Optimization Panel */
    .optimization-panel {
      background: rgba(0, 0, 0, 0.4); border: 1px solid rgba(0, 255, 136, 0.2);
      border-radius: 12px; padding: 24px; backdrop-filter: blur(10px); margin-bottom: 24px;
    }
    .panel-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .panel-title { font-size: 18px; font-weight: 600; color: #ffffff; }
    .optimize-button {
      padding: 12px 24px; background: linear-gradient(45deg, #00ff88, #00b4d8); border: none; border-radius: 8px;
      color: #000000; font-weight: 600; font-size: 14px; cursor: pointer; transition: all 0.3s;
      text-transform: uppercase; letter-spacing: 1px;
    }
    .optimize-button:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 8px 16px rgba(0,255,136,0.3); }
    .optimize-button:disabled { opacity: 0.5; cursor: not-allowed; transform: none; box-shadow: none; }
    .options-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px; }
    .option-card {
      background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px; padding: 16px; transition: all 0.3s;
    }
    .option-card:hover { border-color: rgba(0,255,136,0.3); background: rgba(0,255,136,0.05); }
    .option-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
    .option-title { font-size: 14px; font-weight: 600; color: #ffffff; }
    .option-switch {
      position: relative; width: 48px; height: 24px; background: rgba(255,255,255,0.1);
      border-radius: 12px; cursor: pointer; transition: all 0.3s;
    }
    .option-switch.active { background: #00ff88; }
    .option-switch::after {
      content: ''; position: absolute; top: 2px; left: 2px; width: 20px; height: 20px;
      background: #ffffff; border-radius: 50%; transition: all 0.3s;
    }
    .option-switch.active::after { transform: translateX(24px); }
    .option-description { font-size: 12px; color: #8a92a5; line-height: 1.4; }

    /* Progress Modal */
    .progress-modal {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8);
      display: none; align-items: center; justify-content: center; z-index: 1000; backdrop-filter: blur(10px);
    }
    .progress-modal.show { display: flex; }
    .progress-content {
      background: linear-gradient(135deg, #1a1a2e, #16213e);
      border: 1px solid rgba(0,255,136,0.3); border-radius: 16px; padding: 40px; text-align: center;
      min-width: 400px; backdrop-filter: blur(20px);
    }
    .progress-title { font-size: 20px; font-weight: 600; margin-bottom: 16px; color: #ffffff; }
    .progress-step { font-size: 14px; color: #8a92a5; margin-bottom: 24px; min-height: 20px; }
    .progress-bar-large { width: 100%; height: 12px; background: rgba(255,255,255,0.1); border-radius: 6px; overflow: hidden; margin-bottom: 16px; }
    .progress-fill-large {
      height: 100%; background: linear-gradient(90deg, #00ff88, #00b4d8); border-radius: 6px; transition: width 0.5s; position: relative;
    }
    .progress-fill-large::after {
      content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent); animation: shimmer 2s infinite;
    }
    @keyframes shimmer { 0% { transform: translateX(-100%); } 100% { transform: translateX(100%); } }
    .progress-percentage { font-size: 18px; font-weight: 600; color: #00ff88; }

    /* Restore Points */
    .restore-points { margin-top: 24px; }
    .restore-point-item {
      background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px; padding: 16px; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center;
      transition: all 0.3s;
    }
    .restore-point-item:hover { border-color: rgba(0,255,136,0.3); background: rgba(0,255,136,0.05); }
    .restore-point-info h4 { color: #ffffff; font-size: 14px; margin-bottom: 4px; }
    .restore-point-info p { color: #8a92a5; font-size: 12px; }
    .restore-button {
      padding: 8px 16px; background: rgba(0,255,136,0.1); border: 1px solid rgba(0,255,136,0.3);
      border-radius: 6px; color: #00ff88; font-size: 12px; cursor: pointer; transition: all 0.3s;
    }
    .restore-button:hover:not(:disabled) { background: rgba(0,255,136,0.2); transform: translateY(-1px); }
    .restore-button:disabled { opacity: 0.5; cursor: not-allowed; }

    /* Debug Panel */
    .debug-section { margin-bottom: 24px; }
    .debug-section h3 { color: #ffffff; margin-bottom: 12px; font-size: 16px; }
    .test-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px; margin-bottom: 16px; }
    .test-button {
      padding: 12px 16px; background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; color: #ffffff; font-size: 13px; cursor: pointer; transition: all 0.3s;
    }
    .test-button:hover:not(:disabled) { border-color: rgba(0,255,136,0.5); background: rgba(0,255,136,0.1); }
    .test-button:disabled { opacity: 0.5; cursor: not-allowed; }
    .test-button.success { border-color: #00ff88; background: rgba(0,255,136,0.1); }
    .test-button.error { border-color: #ff4757; background: rgba(255,71,87,0.1); }

    .log-viewer {
      background: rgba(0,0,0,0.6); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px;
      padding: 16px; height: 300px; overflow-y: auto; font-family: 'Courier New', monospace;
      font-size: 12px; line-height: 1.4; color: #ffffff; white-space: pre-wrap;
    }

    /* Inputs */
    input[type="text"] { outline: none; }
    input[type="text"]:focus { border-color: rgba(0,255,136,0.5); }

    /* Scrollbar */
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: rgba(255,255,255,0.05); border-radius: 4px; }
    ::-webkit-scrollbar-thumb { background: rgba(0,255,136,0.3); border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: rgba(0,255,136,0.5); }

    /* Animations */
    .fade-in { animation: fadeIn 0.5s ease-in-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .slide-in-left { animation: slideInLeft 0.3s ease-out; }
    @keyframes slideInLeft { from { transform: translateX(-20px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

    /* Responsive */
    @media (max-width: 768px) {
      .sidebar { width: 240px; }
      .dashboard-grid { grid-template-columns: 1fr; }
      .options-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <!-- Custom Titlebar -->
  <div class="titlebar">
    <div class="titlebar-title">Aura Gaming PC Optimizer</div>
    <div class="titlebar-controls">
      <button class="titlebar-button minimize" id="minimize-btn">−</button>
      <button class="titlebar-button maximize" id="maximize-btn">□</button>
      <button class="titlebar-button close" id="close-btn">×</button>
    </div>
  </div>

  <div class="main-container">
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="sidebar-header">
        <div class="logo">AURA</div>
        <div class="tagline">Gaming Optimizer</div>
      </div>

      <nav class="nav-menu">
        <div class="nav-item active" data-page="dashboard">
          <svg class="nav-icon" viewBox="0 0 24 24" fill="currentColor">
            <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/>
          </svg>
          Dashboard
        </div>
        <div class="nav-item" data-page="optimizer">
          <svg class="nav-icon" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
          </svg>
          Optimizer
        </div>
        <div class="nav-item" data-page="restore">
          <svg class="nav-icon" viewBox="0 0 24 24" fill="currentColor">
            <path d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9z"/>
          </svg>
          Restore Points
        </div>
        <div class="nav-item" data-page="debug">
          <svg class="nav-icon" viewBox="0 0 24 24" fill="currentColor">
            <path d="M20 8h-2.81c-.45-.78-1.07-1.45-1.82-1.96L17 4.41 15.59 3l-2.17 2.17C12.96 5.06 12.49 5 12 5s-.96.06-1.42.17L8.41 3 7 4.41l1.62 1.63C7.88 6.55 7.26 7.22 6.81 8H4v2h2.09c-.05.33-.09.66-.09 1v1H4v2h2v1c0 .34.04.67.09 1H4v2h2.81c1.04 1.79 2.97 3 5.19 3s4.15-1.21 5.19-3H20v-2h-2.09c.05-.33.09-.66.09-1v-1h2v-2h-2v-1c0-.34-.04-.67-.09-1H20V8z"/>
          </svg>
          Debug
        </div>
        <div class="nav-item" data-page="settings">
          <svg class="nav-icon" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 15.5A3.5 3.5 0 0 1 8.5 12A3.5 3.5 0 0 1 12 8.5a3.5 3.5 0 0 1 3.5 3.5 3.5 3.5 0 0 1-3.5 3.5m7.43-2.53c.04-.32.07-.64.07-.97 0-.33-.03-.66-.07-1l2.11-1.63c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.31-.61-.22l-2.49 1c-.52-.39-1.06-.73-1.69-.98l-.37-2.65A.506.506 0 0 0 14 2h-4c-.25 0-.46.18-.5.42l-.37 2.65c-.63.25-1.17.59-1.69.98l-2.49-1c-.22-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64L4.57 11c-.04.34-.07.67-.07 1 0 .33.03.65.07.97l-2.11 1.66c-.19.15-.25.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1.01c.52.4 1.06.74 1.69.99l.37 2.65c.04.24.25.42.5.42h4c.25 0 .46-.18.5-.42l.37-2.65c.63-.26 1.17-.59 1.69-.99l2.49 1.01c.22.08.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.66Z"/>
          </svg>
          Settings
        </div>
        <div class="nav-item" data-page="license">
          <svg class="nav-icon" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1M12,7C13.4,7 14.8,8.6 14.8,10V11.5C15.4,11.5 16,12.4 16,13V16C16,16.6 15.6,17 15,17H9C8.4,17 8,16.6 8,16V13C8,12.4 8.4,11.5 9,11.5V10C9,8.6 10.6,7 12,7M12,8.2C11.2,8.2 10.2,8.7 10.2,10V11.5H13.8V10C13.8,8.7 12.8,8.2 12,8.2Z"/>
          </svg>
          License
        </div>
      </nav>

      <div class="license-status">
        <div class="status-indicator inactive" id="license-status">
          <div class="status-dot"></div>
          <span>License Inactive</span>
        </div>
      </div>
    </div>

    <!-- Content Area -->
    <div class="content">
      <!-- Dashboard Page -->
      <div class="page" id="dashboard-page">
        <div class="content-header">
          <h1 class="content-title">System Dashboard</h1>
          <p class="content-subtitle">Monitor your system performance and optimization status</p>
        </div>

        <div class="content-body">
          <div class="dashboard-grid">
            <div class="stat-card">
              <div class="stat-header">
                <span class="stat-title">RAM Usage</span>
                <svg class="stat-icon" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M17,7H22V9H17V7M17,15H22V17H17V15M17,11H22V13H17V11M15,9H7L10.5,13L7,17H15A2,2 0 0,0 17,15V11A2,2 0 0,0 15,9Z"/>
                </svg>
              </div>
              <div class="stat-value" id="ram-usage">0.00 GB</div>
              <div class="stat-label">of <span id="total-ram">0.00 GB</span> used</div>
              <div class="progress-bar">
                <div class="progress-fill" id="ram-progress" style="width: 0%"></div>
              </div>
            </div>

            <div class="stat-card">
              <div class="stat-header">
                <span class="stat-title">Network Latency</span>
                <svg class="stat-icon" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M1,9L12,1L21,9H19V20H15V14H9V20H5V9H3M7,11H9V12H7V11M11,11H13V12H11V11M15,11H17V12H15V11Z"/>
                </svg>
              </div>
              <div class="stat-value" id="latency">-- ms</div>
              <div class="stat-label">ping to 8.8.8.8</div>
              <div class="progress-bar">
                <div class="progress-fill" id="latency-progress" style="width: 0%"></div>
              </div>
            </div>

            <div class="stat-card">
              <div class="stat-header">
                <span class="stat-title">Last Optimization</span>
                <svg class="stat-icon" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M16.2,16.2L11,13V7H12.5V12.2L17,14.9L16.2,16.2Z"/>
                </svg>
              </div>
              <div class="stat-value" id="last-optimization">Never</div>
              <div class="stat-label" id="optimization-details">No optimizations yet</div>
            </div>

            <div class="stat-card">
              <div class="stat-header">
                <span class="stat-title">Graphics Card</span>
                <svg class="stat-icon" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M5,13.18V14.82L3,16.82V21H5V17.18L7,15.18V13.82L5,15.82V13.18M9,15.18V17.18L11,19.18H13V17.82L9,15.18M15,21H21V19H15V21M15,13H21V15H15V13M15,17H21V19H15V17M15,9H21V11H15V9M3,5V7H21V5H3Z"/>
                </svg>
              </div>
              <div class="stat-value" id="gpu-model" style="font-size: 16px;">Loading...</div>
              <div class="stat-label">Primary GPU</div>
            </div>
          </div>

          <div class="optimization-panel">
            <div class="panel-header">
              <h2 class="panel-title">Quick Optimization</h2>
              <button class="optimize-button" id="quick-optimize-btn">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 8px;">
                  <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                </svg>
                Optimize Now
              </button>
            </div>
            <p style="color: #8a92a5; margin-bottom: 16px;">Run a comprehensive optimization with your current settings</p>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
              <div style="text-align: center;">
                <div style="font-size: 24px; font-weight: 600; color: #00ff88;" id="ram-freed-display">0.00 GB</div>
                <div style="font-size: 12px; color: #8a92a5;">RAM Freed</div>
              </div>
              <div style="text-align: center;">
                <div style="font-size: 24px; font-weight: 600; color: #00b4d8;" id="junk-cleaned-display">0.00 GB</div>
                <div style="font-size: 12px; color: #8a92a5;">Junk Cleaned</div>
              </div>
            </div>
          </div>

          <div class="stat-card" style="margin-top: 24px;">
            <div class="stat-header">
              <span class="stat-title">Application Performance</span>
              <svg class="stat-icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M13,9H11V7H13M13,17H11V11H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"/>
              </svg>
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 16px; margin-top: 16px;">
              <div style="text-align: center;">
                <div style="font-size: 18px; font-weight: 600; color: #ffffff;" id="app-memory-usage">-- MB</div>
                <div style="font-size: 11px; color: #8a92a5;">Memory Usage</div>
              </div>
              <div style="text-align: center;">
                <div style="font-size: 18px; font-weight: 600; color: #ffffff;" id="app-version">v1.0.0</div>
                <div style="font-size: 11px; color: #8a92a5;">Version</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Optimizer Page -->
      <div class="page" id="optimizer-page" style="display:none;">
        <div class="content-header">
          <h1 class="content-title">System Optimizer</h1>
          <p class="content-subtitle">Customize your optimization settings</p>
        </div>
        <div class="content-body">
          <div class="optimization-panel">
            <div class="panel-header">
              <h2 class="panel-title">Optimization Categories</h2>
              <div style="display:flex; gap:12px;">
                <button class="restore-button" id="create-restore-point-btn">Create Restore Point</button>
                <button class="optimize-button" id="main-optimize-btn">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 8px;">
                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                  </svg>
                  Run Optimization
                </button>
              </div>
            </div>
            <div class="options-grid" id="optimization-options"></div>
          </div>
        </div>
      </div>

      <!-- Restore Points Page -->
      <div class="page" id="restore-page" style="display:none;">
        <div class="content-header">
          <h1 class="content-title">Restore Points</h1>
          <p class="content-subtitle">Manage system restore points</p>
        </div>
        <div class="content-body">
          <div class="optimization-panel">
            <div class="panel-header">
              <h2 class="panel-title">System Restore Points</h2>
              <button class="restore-button" id="manual-restore-point-btn">Create Manual Restore Point</button>
            </div>
            <p style="color:#8a92a5; margin-bottom:20px;">Restore points allow you to revert your system to a previous state if needed.</p>
            <div class="restore-points" id="restore-points-list"></div>
          </div>
        </div>
      </div>

      <!-- Debug Page -->
      <div class="page" id="debug-page" style="display:none;">
        <div class="content-header">
          <h1 class="content-title">Debug & Testing</h1>
          <p class="content-subtitle">Test individual optimization features and view logs</p>
        </div>
        <div class="content-body">
          <div class="debug-section">
            <h3>Feature Testing</h3>
            <div class="test-grid" id="feature-tests"></div>
          </div>

          <div class="debug-section">
            <h3>System Health Check</h3>
            <button class="test-button" id="health-check-btn" style="margin-bottom:16px;">Run System Health Check</button>
            <div id="health-results" style="display:none; background: rgba(0,0,0,0.4); padding:16px; border-radius:8px; margin-bottom:16px;">
              <h4 style="color:#00ff88; margin-bottom:8px;">Health Check Results</h4>
              <div id="health-content"></div>
            </div>
          </div>

          <div class="debug-section">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
              <h3>Debug Logs</h3>
              <div style="display:flex; gap:8px;">
                <button class="restore-button" id="refresh-logs-btn">Refresh</button>
                <button class="restore-button" id="clear-logs-btn">Clear Logs</button>
                <button class="restore-button" id="export-report-btn">Export Report</button>
              </div>
            </div>
            <div class="log-viewer" id="log-viewer">Loading logs...</div>
          </div>
        </div>
      </div>

      <!-- Settings Page -->
      <div class="page" id="settings-page" style="display:none;">
        <div class="content-header">
          <h1 class="content-title">Settings</h1>
          <p class="content-subtitle">Configure application preferences</p>
        </div>
        <div class="content-body">
          <div class="optimization-panel">
            <div class="panel-header"><h2 class="panel-title">General Settings</h2></div>
            <div class="option-card">
              <div class="option-header">
                <span class="option-title">Enable Optimizer</span>
                <div class="option-switch" id="optimizer-toggle"></div>
              </div>
              <p class="option-description">Enable or disable the system optimizer functionality</p>
            </div>
            <div class="option-card">
              <div class="option-header">
                <span class="option-title">Debug Mode</span>
                <div class="option-switch" id="debug-toggle"></div>
              </div>
              <p class="option-description">Enable debug mode for advanced logging and testing features</p>
            </div>
          </div>

          <div class="optimization-panel">
            <div class="panel-header"><h2 class="panel-title">About</h2></div>
            <div style="text-align:center; padding:20px;">
              <div class="logo" style="font-size:48px; margin-bottom:16px;">AURA</div>
              <p style="color:#8a92a5; margin-bottom:16px;">Gaming PC Optimizer</p>
              <p style="color:#ffffff; margin-bottom:8px;" id="about-version">Version 1.0.0</p>
              <p style="color:#8a92a5; font-size:12px;" id="about-hwid">Hardware ID: Loading...</p>
            </div>
          </div>
        </div>
      </div>

      <!-- License Page -->
      <div class="page" id="license-page" style="display:none;">
        <div class="content-header">
          <h1 class="content-title">License Management</h1>
          <p class="content-subtitle">Activate your license to unlock full features</p>
        </div>
        <div class="content-body">
          <div class="optimization-panel">
            <div class="panel-header"><h2 class="panel-title">License Activation</h2></div>

            <div id="license-inactive" style="text-align:center; padding:40px;">
              <svg width="64" height="64" viewBox="0 0 24 24" fill="currentColor" style="color:#ff4757; margin-bottom:16px;">
                <path d="M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1M12,7C13.4,7 14.8,8.6 14.8,10V11.5C15.4,11.5 16,12.4 16,13V16C16,16.6 15.6,17 15,17H9C8.4,17 8,16.6 8,16V13C8,12.4 8.4,11.5 9,11.5V10C9,8.6 10.6,7 12,7M12,8.2C11.2,8.2 10.2,8.7 10.2,10V11.5H13.8V10C13.8,8.7 12.8,8.2 12,8.2Z"/>
              </svg>
              <h3 style="color:#ffffff; margin-bottom:8px;">License Required</h3>
              <p style="color:#8a92a5; margin-bottom:24px;">Enter your license key to activate the optimizer</p>
              <div style="max-width:400px; margin:0 auto;">
                <input type="text" id="license-key-input" placeholder="Enter your license key" style="
                  width:100%; padding:12px 16px; background:rgba(255,255,255,0.1);
                  border:1px solid rgba(255,255,255,0.2); border-radius:8px; color:#ffffff; font-size:14px; margin-bottom:16px; text-align:center;">
                <button class="optimize-button" id="activate-license-btn" style="width:100%;">Activate License</button>
              </div>
              <p style="color:#8a92a5; font-size:12px; margin-top:16px;">Hardware ID: <span id="hwid-display">Loading...</span></p>
            </div>

            <div id="license-active" style="display:none; text-align:center; padding:40px;">
              <svg width="64" height="64" viewBox="0 0 24 24" fill="currentColor" style="color:#00ff88; margin-bottom:16px;">
                <path d="M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1M10,17L6,13L7.41,11.59L10,14.17L16.59,7.58L18,9L10,17Z"/>
              </svg>
              <h3 style="color:#00ff88; margin-bottom:8px;">License Active</h3>
              <p style="color:#8a92a5; margin-bottom:24px;">Your license is active and all features are unlocked</p>
              <button class="restore-button" id="deactivate-license-btn">Deactivate License</button>
            </div>
          </div>
        </div>
      </div>
    </div> <!-- /content -->
  </div> <!-- /main-container -->

  <!-- Progress Modal -->
  <div class="progress-modal" id="progress-modal">
    <div class="progress-content">
      <h2 class="progress-title">Optimizing System</h2>
      <div class="progress-step" id="progress-step">Preparing optimization...</div>
      <div class="progress-bar-large">
        <div class="progress-fill-large" id="progress-fill" style="width: 0%"></div>
      </div>
      <div class="progress-percentage" id="progress-percentage">0%</div>
    </div>
  </div>

  <script>
    // App state
    const AppConfig = {
      currentPage: 'dashboard',
      isOptimizing: false,
      systemStats: {},
      options: {},
      restorePoints: [],
      debugMode: false,
    };

    const OptimizationOptions = [
      { key: 'gameMode', title: 'Game Mode', description: 'Enable Windows Game Mode for better gaming performance', category: 'Performance', alwaysOn: true },
      { key: 'backgroundProcessTrim', title: 'Background Process Cleanup', description: 'Terminate heavy background applications to free up resources', category: 'Performance' },
      { key: 'diskCleanup', title: 'Disk Cleanup', description: 'Clean temporary files and system cache', category: 'Storage' },
      { key: 'browserCacheCleanup', title: 'Browser Cache Cleanup', description: 'Clear browser caches to free up disk space', category: 'Storage' },
      { key: 'recycleBinEmpty', title: 'Empty Recycle Bin', description: 'Empty the recycle bin to free up disk space', category: 'Storage' },
      { key: 'windowsUpdateCacheCleanup', title: 'Windows Update Cache', description: 'Clean Windows Update cache files', category: 'Storage' },
      { key: 'logsCleanup', title: 'System Logs Cleanup', description: 'Remove old system logs and crash dumps', category: 'Storage' },
      { key: 'memoryCompression', title: 'Memory Compression', description: 'Enable memory compression to optimize RAM usage', category: 'Memory' },
      { key: 'storageOptimize', title: 'Storage Optimization', description: 'Optimize and defragment storage drives', category: 'Storage' },
      { key: 'dnsSwitch', title: 'DNS Optimization', description: 'Switch to faster DNS servers (1.1.1.1, 8.8.8.8)', category: 'Network' },
      { key: 'tcpTune', title: 'TCP Optimization', description: 'Optimize TCP settings for better network performance', category: 'Network' },
      { key: 'gpuVisualTuning', title: 'Visual Effects Optimization', description: 'Optimize visual effects for better performance', category: 'Graphics' },
      { key: 'hardwareGpuScheduling', title: 'Hardware GPU Scheduling', description: 'Enable hardware-accelerated GPU scheduling', category: 'Graphics' },
      { key: 'nvapi', title: 'NVIDIA Optimizations', description: 'Apply NVIDIA-specific performance optimizations', category: 'Graphics' },
      { key: 'startupItems', title: 'Startup Optimization', description: 'Optimize Windows startup programs', category: 'Performance' },
    ];

    document.addEventListener('DOMContentLoaded', async () => {
      setupEventListeners();
      await initializeApp();
      startPeriodicUpdates();
    });

    function setupEventListeners() {
      // Use windowControls from preload.js
      document.getElementById('minimize-btn').addEventListener('click', () => window.windowControls.minimize());
      document.getElementById('maximize-btn').addEventListener('click', () => window.windowControls.maximize());
      document.getElementById('close-btn').addEventListener('click', () => window.windowControls.close());

      document.querySelectorAll('.nav-item').forEach(item => {
        item.addEventListener('click', () => switchToPage(item.dataset.page));
      });

      document.getElementById('quick-optimize-btn').addEventListener('click', runOptimization);
      document.getElementById('main-optimize-btn').addEventListener('click', runOptimization);

      document.getElementById('create-restore-point-btn').addEventListener('click', () => createRestorePoint('Optimization Restore Point'));
      document.getElementById('manual-restore-point-btn').addEventListener('click', () => {
        const description = prompt('Enter restore point description:', 'Manual Restore Point');
        if (description) createRestorePoint(description);
      });

      document.getElementById('optimizer-toggle').addEventListener('click', toggleOptimizer);
      document.getElementById('debug-toggle').addEventListener('click', toggleDebugMode);

      document.getElementById('activate-license-btn').addEventListener('click', activateLicense);
      document.getElementById('deactivate-license-btn').addEventListener('click', deactivateLicense);

      document.getElementById('health-check-btn').addEventListener('click', runHealthCheck);
      document.getElementById('refresh-logs-btn').addEventListener('click', loadDebugLogs);
      document.getElementById('clear-logs-btn').addEventListener('click', clearDebugLogs);
      document.getElementById('export-report-btn').addEventListener('click', exportSystemReport);

      // IPC events
      window.electronAPI.onOptimizationProgress(data => updateProgress(data.step, data.progress));
      window.electronAPI.onOptimizationComplete(data => {
        hideProgressModal();
        AppConfig.isOptimizing = false;
        if (data.ok) {
          showNotification('Optimization completed successfully!', 'success');
          loadSystemStats();
        } else {
          showNotification(data.error || 'Optimization failed', 'error');
        }
      });

      // Global error handlers
      window.addEventListener('error', (event) => {
        console.error('Global error:', event.error);
        showNotification('An unexpected error occurred', 'error');
      });
      window.addEventListener('unhandledrejection', (event) => {
        console.error('Unhandled promise rejection:', event.reason);
        showNotification('An unexpected error occurred', 'error');
      });

      // Shortcuts
      document.addEventListener('keydown', (event) => {
        if (event.ctrlKey && event.key === 'r') {
          event.preventDefault();
          if (AppConfig.currentPage === 'dashboard') loadSystemStats();
          if (AppConfig.currentPage === 'restore') loadRestorePoints();
          if (AppConfig.currentPage === 'debug') loadDebugLogs();
          showNotification('Data refreshed', 'info');
        }
        if (event.ctrlKey && event.key === 'o' && AppConfig.systemStats.isActivated) {
          event.preventDefault();
          runOptimization();
        }
        if (event.key === 'F12' && event.shiftKey) {
          event.preventDefault();
          toggleDebugMode();
        }
      });

      // Responsive
      function handleResize() {
        const sidebar = document.querySelector('.sidebar');
        sidebar.style.width = window.innerWidth < 768 ? '240px' : '280px';
      }
      window.addEventListener('resize', handleResize);
      handleResize();
    }

    async function initializeApp() {
      try {
        await loadSystemStats();
        await loadOptions();
        await checkLicenseStatus();
        await loadRestorePoints();
        renderOptimizationOptions();
        updateDashboard();
        updateSettingsToggles();
        if (AppConfig.debugMode) await loadDebugLogs();
      } catch (e) {
        console.error('Failed to initialize app:', e);
        showNotification('Failed to initialize application', 'error');
      }
    }

    function switchToPage(pageName) {
      document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
      const nav = document.querySelector(`[data-page="${pageName}"]`);
      if (nav) nav.classList.add('active');

      document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
      const target = document.getElementById(`${pageName}-page`);
      if (target) {
        target.style.display = 'block';
        target.classList.add('fade-in');
      }
      AppConfig.currentPage = pageName;

      if (pageName === 'restore') loadRestorePoints();
      if (pageName === 'debug' && AppConfig.debugMode) { loadDebugLogs(); renderFeatureTests(); }
      if (pageName === 'settings') updateSettingsToggles();
    }

    async function loadSystemStats() {
      try {
        const stats = await window.electronAPI.getSystemStats();
        AppConfig.systemStats = stats || {};
        updateDashboard();
      } catch (e) { console.error('Failed to load system stats:', e); }
    }

    function updateDashboard() {
      const s = AppConfig.systemStats || {};
      if (s.totalRamGB && s.usedRamGB) {
        document.getElementById('ram-usage').textContent = `${s.usedRamGB} GB`;
        document.getElementById('total-ram').textContent = `${s.totalRamGB} GB`;
        const pct = Math.min((parseFloat(s.usedRamGB)/parseFloat(s.totalRamGB))*100, 100);
        document.getElementById('ram-progress').style.width = `${pct}%`;
      }
      if (s.latencyMs !== null && s.latencyMs !== undefined) {
        document.getElementById('latency').textContent = `${s.latencyMs} ms`;
        const lp = document.getElementById('latency-progress');
        if (s.latencyMs < 50) { lp.style.width = '90%'; lp.style.background = 'linear-gradient(90deg, #00ff88, #00b4d8)'; }
        else if (s.latencyMs < 100) { lp.style.width = '60%'; lp.style.background = 'linear-gradient(90deg, #ffa726, #ff9800)'; }
        else { lp.style.width = '30%'; lp.style.background = 'linear-gradient(90deg, #ff4757, #ff3742)'; }
      } else {
        document.getElementById('latency').textContent = '-- ms';
        document.getElementById('latency-progress').style.width = '0%';
      }
      if (s.lastOptimization) {
        const t = new Date(s.lastOptimization);
        document.getElementById('last-optimization').textContent = getTimeAgo(t);
        document.getElementById('optimization-details').textContent = `${s.ramFreed} GB RAM freed, ${s.junkCleaned} GB junk cleaned`;
      } else {
        document.getElementById('last-optimization').textContent = 'Never';
        document.getElementById('optimization-details').textContent = 'No optimizations yet';
      }
      if (s.gpuModel) document.getElementById('gpu-model').textContent = s.gpuModel;
      if (s.appMemoryUsage) document.getElementById('app-memory-usage').textContent = `${s.appMemoryUsage.heapUsed} MB`;
      if (s.appVersion) {
        document.getElementById('app-version').textContent = `v${s.appVersion}`;
        document.getElementById('about-version').textContent = `Version ${s.appVersion}`;
      }
      document.getElementById('ram-freed-display').textContent = `${s.ramFreed || 0} GB`;
      document.getElementById('junk-cleaned-display').textContent = `${s.junkCleaned || 0} GB`;
    }

    async function loadOptions() {
      try { AppConfig.options = await window.electronAPI.getOptions(); }
      catch (e) { console.error('Failed to load options:', e); }
    }

    function renderOptimizationOptions() {
      const container = document.getElementById('optimization-options');
      container.innerHTML = '';
      const groups = {};
      OptimizationOptions.forEach(o => { (groups[o.category] ||= []).push(o); });
      Object.entries(groups).forEach(([cat, opts]) => {
        const sec = document.createElement('div');
        sec.style.gridColumn = '1 / -1';
        sec.innerHTML = `<h3 style="color:#00ff88; margin-bottom:12px; font-size:16px; border-bottom:1px solid rgba(0,255,136,0.2); padding-bottom:8px;">${cat} Optimizations</h3>`;
        container.appendChild(sec);
        opts.forEach(opt => {
          const enabled = AppConfig.options[opt.key] !== false;
          const el = document.createElement('div');
          el.className = 'option-card';
          el.innerHTML = `
            <div class="option-header">
              <span class="option-title">${opt.title}</span>
              <div class="option-switch ${enabled ? 'active' : ''}" data-option="${opt.key}" ${opt.alwaysOn ? 'style="opacity:.5; cursor:not-allowed;"' : ''}></div>
            </div>
            <p class="option-description">${opt.description}</p>
            ${opt.alwaysOn ? '<p style="font-size:11px; color:#8a92a5; margin-top:8px;">Always enabled</p>' : ''}`;
          container.appendChild(el);
          if (!opt.alwaysOn) el.querySelector('.option-switch').addEventListener('click', () => toggleOption(opt.key));
        });
      });
    }

    async function toggleOption(key) {
      const newVal = !(AppConfig.options[key]);
      try {
        const res = await window.electronAPI.setOptions({ [key]: newVal });
        if (res.ok) {
          AppConfig.options = res.options;
          const t = document.querySelector(`[data-option="${key}"]`);
          if (t) t.classList.toggle('active', newVal);
        }
      } catch (e) { console.error('Failed to toggle option:', e); showNotification('Failed to update option', 'error'); }
    }

    async function checkLicenseStatus() {
      try {
        const stats = await window.electronAPI.getSystemStats();
        const hwid = await window.electronAPI.getHWID();
        updateLicenseStatus(!!stats.isActivated);
        if (hwid.ok) {
          document.getElementById('hwid-display').textContent = hwid.hwid;
          document.getElementById('about-hwid').textContent = `Hardware ID: ${hwid.hwid}`;
        }
      } catch (e) { console.error('Failed to check license:', e); }
    }

    function updateLicenseStatus(active) {
      const status = document.getElementById('license-status');
      const activePanel = document.getElementById('license-active');
      const inactivePanel = document.getElementById('license-inactive');
      if (active) {
        status.className = 'status-indicator active';
        status.innerHTML = '<div class="status-dot"></div><span>License Active</span>';
        activePanel.style.display = 'block';
        inactivePanel.style.display = 'none';
      } else {
        status.className = 'status-indicator inactive';
        status.innerHTML = '<div class="status-dot"></div><span>License Inactive</span>';
        activePanel.style.display = 'none';
        inactivePanel.style.display = 'block';
      }
    }

    async function activateLicense() {
      const keyEl = document.getElementById('license-key-input');
      const key = keyEl.value.trim();
      if (!key) return showNotification('Please enter a license key', 'error');
      try {
        const hwid = await window.electronAPI.getHWID();
        if (!hwid.ok) return showNotification('Failed to get hardware ID', 'error');
        const btn = document.getElementById('activate-license-btn');
        btn.disabled = true; btn.textContent = 'Activating...';
        // IMPORTANT: pass (key, hwid) as two args to match preload
        const result = await window.electronAPI.activateLicense(key, hwid.hwid);
        if (result.ok) {
          showNotification('License activated successfully!', 'success');
          updateLicenseStatus(true);
          keyEl.value = '';
          await loadSystemStats();
        } else {
          showNotification(result.error || 'License activation failed', 'error');
        }
      } catch (e) {
        console.error('License activation error:', e);
        showNotification('License activation failed', 'error');
      } finally {
        const btn = document.getElementById('activate-license-btn');
        btn.disabled = false; btn.textContent = 'Activate License';
      }
    }

    async function deactivateLicense() {
      if (!confirm('Are you sure you want to deactivate your license?')) return;
      try {
        const btn = document.getElementById('deactivate-license-btn');
        btn.disabled = true; btn.textContent = 'Deactivating...';
        const res = await window.electronAPI.logout();
        if (res.ok) {
          showNotification('License deactivated successfully', 'success');
          updateLicenseStatus(false);
          await loadSystemStats();
        } else {
          showNotification(res.error || 'License deactivation failed', 'error');
        }
      } catch (e) {
        console.error('License deactivation error:', e);
        showNotification('License deactivation failed', 'error');
      } finally {
        const btn = document.getElementById('deactivate-license-btn');
        btn.disabled = false; btn.textContent = 'Deactivate License';
      }
    }

    async function toggleOptimizer() {
      try {
        const current = !!AppConfig.systemStats.isOptimizerEnabled;
        const res = await window.electronAPI.toggleOptimizer(!current);
        if (res.ok) {
          AppConfig.systemStats.isOptimizerEnabled = res.isEnabled;
          updateSettingsToggles();
          showNotification(`Optimizer ${res.isEnabled ? 'enabled' : 'disabled'}`, 'success');
        }
      } catch (e) { console.error('Toggle optimizer error:', e); showNotification('Failed to update optimizer setting', 'error'); }
    }

    async function toggleDebugMode() {
      try {
        const res = await window.electronAPI.toggleDebugMode(!AppConfig.debugMode);
        if (res.ok) {
          AppConfig.debugMode = res.debugMode;
          updateSettingsToggles();
          showNotification(`Debug mode ${res.debugMode ? 'enabled' : 'disabled'}`, 'success');
          if (res.debugMode) { await loadDebugLogs(); renderFeatureTests(); }
        }
      } catch (e) { console.error('Toggle debug error:', e); showNotification('Failed to update debug mode', 'error'); }
    }

    function updateSettingsToggles() {
      document.getElementById('optimizer-toggle').classList.toggle('active', !!AppConfig.systemStats.isOptimizerEnabled);
      document.getElementById('debug-toggle').classList.toggle('active', !!AppConfig.debugMode);
    }

    async function runOptimization() {
      if (AppConfig.isOptimizing) return;
      if (!AppConfig.systemStats.isActivated) {
        showNotification('License activation required', 'error');
        switchToPage('license');
        return;
      }
      AppConfig.isOptimizing = true;
      showProgressModal();
      try {
        const res = await window.electronAPI.performOptimization(AppConfig.options);
        if (res.ok) {
          showNotification('Optimization completed successfully!', 'success');
          loadSystemStats();
        } else {
          showNotification(res.error || 'Optimization failed', 'error');
        }
      } catch (e) {
        console.error('Optimization error:', e);
        showNotification('Optimization failed', 'error');
      } finally {
        hideProgressModal();
        AppConfig.isOptimizing = false;
      }
    }

    async function loadRestorePoints() {
      try {
        const res = await window.electronAPI.getRestorePoints();
        if (res.ok) { AppConfig.restorePoints = res.restorePoints || []; renderRestorePoints(); }
      } catch (e) { console.error('Failed to load restore points:', e); }
    }

    function renderRestorePoints() {
      const c = document.getElementById('restore-points-list');
      if (!AppConfig.restorePoints.length) {
        c.innerHTML = `
          <div style="text-align:center; padding:40px; color:#8a92a5;">
            <p>No restore points available</p>
            <p style="font-size:12px; margin-top:8px;">Create a restore point before making system changes</p>
          </div>`;
        return;
      }
      c.innerHTML = AppConfig.restorePoints.map(p => `
        <div class="restore-point-item">
          <div class="restore-point-info">
            <h4>${p.description}</h4>
            <p>${formatDate(p.createdAt)} • ${formatBytes(p.size)}</p>
          </div>
          <button class="restore-button" onclick="restoreFromPoint('${p.id}')">Restore</button>
        </div>`).join('');
    }

    async function createRestorePoint(description) {
      const btn = document.getElementById('create-restore-point-btn') || document.getElementById('manual-restore-point-btn');
      try {
        if (btn) { btn.disabled = true; btn.textContent = 'Creating...'; }
        const res = await window.electronAPI.createRestorePoint(description);
        if (res.ok) {
          showNotification('Restore point created successfully', 'success');
          await loadRestorePoints();
        } else {
          showNotification(res.error || 'Failed to create restore point', 'error');
        }
      } catch (e) {
        console.error('Create restore point error:', e);
        showNotification('Failed to create restore point', 'error');
      } finally {
        if (btn) {
          btn.disabled = false;
          btn.textContent = btn.id?.includes('manual') ? 'Create Manual Restore Point' : 'Create Restore Point';
        }
      }
    }

    async function restoreFromPoint(id) {
      if (!confirm('Are you sure you want to restore your system? This will launch Windows System Restore.')) return;
      try {
        const res = await window.electronAPI.restoreFromPoint(id);
        if (res.ok) showNotification(res.message || 'System Restore launched', 'success');
        else showNotification(res.error || 'System restore failed', 'error');
      } catch (e) { console.error('System restore error:', e); showNotification('System restore failed', 'error'); }
    }

    function renderFeatureTests() {
      const c = document.getElementById('feature-tests');
      const feats = [
        { key: 'gameMode', name: 'Game Mode' },
        { key: 'backgroundProcessTrim', name: 'Process Cleanup' },
        { key: 'diskCleanup', name: 'Disk Cleanup' },
        { key: 'browserCacheCleanup', name: 'Browser Cache' },
        { key: 'recycleBinEmpty', name: 'Recycle Bin' },
        { key: 'memoryOptimization', name: 'Memory Optimize' },
        { key: 'networkOptimization', name: 'Network Optimize' },
        { key: 'visualEffects', name: 'Visual Effects' },
        { key: 'gpuScheduling', name: 'GPU Scheduling' },
        { key: 'nvapi', name: 'NVIDIA API' },
        { key: 'startupItems', name: 'Startup Items' },
      ];
      c.innerHTML = feats.map(f => `<button class="test-button" onclick="testFeature('${f.key}')" id="test-${f.key}">Test ${f.name}</button>`).join('');
    }

    async function testFeature(featureKey) {
      const btn = document.getElementById(`test-${featureKey}`);
      btn.disabled = true; btn.textContent = 'Testing...'; btn.className = 'test-button';
      try {
        const res = await window.electronAPI.testOptimizationFeature(featureKey);
        if (res.ok) { btn.className = 'test-button success'; btn.textContent = `✓ ${featureKey}`; showNotification(`${featureKey} test completed successfully`, 'success'); }
        else { btn.className = 'test-button error'; btn.textContent = `✗ ${featureKey}`; showNotification(res.error || `${featureKey} test failed`, 'error'); }
      } catch (e) {
        btn.className = 'test-button error'; btn.textContent = `✗ ${featureKey}`; showNotification(`${featureKey} test failed`, 'error');
      } finally {
        btn.disabled = false;
        setTimeout(() => { btn.className = 'test-button'; btn.textContent = `Test ${featureKey}`; }, 3000);
      }
    }

    async function runHealthCheck() {
      const btn = document.getElementById('health-check-btn');
      btn.disabled = true; btn.textContent = 'Running Health Check...';
      try {
        const res = await window.electronAPI.runSystemHealthCheck();
        if (res.ok) { displayHealthResults(res); showNotification('Health check completed', 'success'); }
        else { showNotification(res.error || 'Health check failed', 'error'); }
      } catch (e) {
        console.error('Health check error:', e);
        showNotification('Health check failed', 'error');
      } finally { btn.disabled = false; btn.textContent = 'Run System Health Check'; }
    }

    function displayHealthResults(data) {
      const resultsDiv = document.getElementById('health-results');
      const contentDiv = document.getElementById('health-content');
      const score = data.score || 0;
      const color = score >= 80 ? '#00ff88' : score >= 60 ? '#ffa726' : '#ff4757';
      contentDiv.innerHTML = `
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
          <span>Overall Health Score</span>
          <span style="color:${color}; font-weight:600; font-size:18px;">${score}/100</span>
        </div>
        ${data.issues && data.issues.length ? `
          <div style="margin-bottom:16px;">
            <h5 style="color:#ffffff; margin-bottom:8px;">Issues Found:</h5>
            ${data.issues.map(i => `<div style="padding:8px; background:rgba(255,71,87,0.1); border-left:3px solid #ff4757; margin-bottom:4px;"><strong>${i.category}:</strong> ${i.message}</div>`).join('')}
          </div>` : '<p style="color:#00ff88;">No issues detected</p>'}
        <div style="font-size:12px; color:#8a92a5;">Health check completed at ${new Date().toLocaleString()}</div>`;
      resultsDiv.style.display = 'block';
    }

    async function loadDebugLogs() {
      try {
        const res = await window.electronAPI.getDebugLogs();
        const viewer = document.getElementById('log-viewer');
        if (res.ok) {
          viewer.textContent = `=== MAIN LOG ===\n${res.logs.main}\n\n=== DEBUG LOG ===\n${res.logs.debug}`;
          viewer.scrollTop = viewer.scrollHeight;
        } else viewer.textContent = 'Failed to load logs: ' + (res.error || 'Unknown error');
      } catch (e) {
        console.error('Load debug logs error:', e);
        document.getElementById('log-viewer').textContent = 'Error loading logs: ' + e.message;
      }
    }

    async function clearDebugLogs() {
      if (!confirm('Are you sure you want to clear all debug logs?')) return;
      try {
        const res = await window.electronAPI.clearDebugLogs();
        if (res.ok) { showNotification('Debug logs cleared', 'success'); await loadDebugLogs(); }
        else showNotification(res.error || 'Failed to clear logs', 'error');
      } catch (e) {
        console.error('Clear logs error:', e); showNotification('Failed to clear logs', 'error');
      }
    }

    async function exportSystemReport() {
      const btn = document.getElementById('export-report-btn');
      btn.disabled = true; btn.textContent = 'Exporting...';
      try {
        const res = await window.electronAPI.exportSystemReport();
        if (res.ok) showNotification('System report exported successfully', 'success');
        else showNotification(res.error || 'Failed to export report', 'error');
      } catch (e) {
        console.error('Export report error:', e); showNotification('Failed to export report', 'error');
      } finally { btn.disabled = false; btn.textContent = 'Export Report'; }
    }

    // Progress modal helpers
    function showProgressModal() { document.getElementById('progress-modal').classList.add('show'); updateProgress('Initializing...', 0); }
    function hideProgressModal() { document.getElementById('progress-modal').classList.remove('show'); }
    function updateProgress(step, pct) {
      document.getElementById('progress-step').textContent = step;
      document.getElementById('progress-fill').style.width = `${pct}%`;
      document.getElementById('progress-percentage').textContent = `${pct}%`;
    }

    // Utilities
    function showNotification(message, type='info') {
      const el = document.createElement('div');
      el.className = `notification ${type}`;
      el.style.cssText = `
        position: fixed; top: 60px; right: 20px; padding: 12px 20px; border-radius: 8px; color: #ffffff;
        font-weight: 500; font-size: 14px; z-index: 10000; max-width: 300px; backdrop-filter: blur(10px); animation: slideInRight 0.3s ease-out;`;
      if (type === 'success') { el.style.background = 'rgba(0, 255, 136, 0.9)'; el.style.border = '1px solid #00ff88'; el.style.color = '#000'; }
      else if (type === 'error') { el.style.background = 'rgba(255, 71, 87, 0.9)'; el.style.border = '1px solid #ff4757'; }
      else { el.style.background = 'rgba(0, 180, 216, 0.9)'; el.style.border = '1px solid #00b4d8'; }
      el.textContent = message;
      document.body.appendChild(el);
      setTimeout(() => {
        el.style.animation = 'slideOutRight 0.3s ease-in forwards';
        setTimeout(() => el.parentNode && document.body.removeChild(el), 300);
      }, 3000);
    }

    function formatDate(s) { const d = new Date(s); return d.toLocaleDateString() + ' ' + d.toLocaleTimeString(); }
    function formatBytes(b) {
      if (!b) return '0 Bytes';
      const k = 1024, sizes = ['Bytes','KB','MB','GB']; const i = Math.floor(Math.log(b)/Math.log(k));
      return parseFloat((b/Math.pow(k,i)).toFixed(2)) + ' ' + sizes[i];
    }
    function getTimeAgo(date) {
      const diffMs = Date.now() - date.getTime();
      const mins = Math.floor(diffMs / 60000), hrs = Math.floor(diffMs / 3600000), days = Math.floor(diffMs / 86400000);
      if (mins < 1) return 'Just now';
      if (mins < 60) return `${mins} minute${mins>1?'s':''} ago`;
      if (hrs < 24) return `${hrs} hour${hrs>1?'s':''} ago`;
      if (days < 7) return `${days} day${days>1?'s':''} ago`;
      return date.toLocaleDateString();
    }

    function startPeriodicUpdates() {
      setInterval(async () => {
        if (!AppConfig.isOptimizing && AppConfig.currentPage === 'dashboard') await loadSystemStats();
      }, 30000);
      setInterval(async () => {
        if (AppConfig.debugMode && AppConfig.currentPage === 'debug') {
          try {
            const m = await window.electronAPI.getPerformanceMetrics();
            if (m.ok) updatePerformanceMetrics(m.metrics);
          } catch {}
        }
      }, 10000);
    }
    function updatePerformanceMetrics(metrics) { console.log('Performance metrics:', metrics); }

    // Extra animations (notifications)
    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideInRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
      @keyframes slideOutRight { from { transform: translateX(0); opacity: 1; } to { transform: translateX(100%); opacity: 0; } }
      .notification { animation: slideInRight 0.3s ease-out; }`;
    document.head.appendChild(style);

    // Dev mode indicator
    if (window.electronAPI && window.electronAPI.isDevelopment) {
      console.log('Running in development mode');
      AppConfig.debugMode = true;
    }
  </script>
</body>
</html>
